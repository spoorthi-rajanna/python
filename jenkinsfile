pipeline {
    agent any
    stages {
        stage('Build') {

            steps {
                sh 'python -m py_compile app.py config.py fabfile.py forms.py models.py'
            }
        }
         /* stage('Test') { 

            steps {
                sh 'py.test --verbose --junit-xml test-reports/results.xml app.py config.py fabfile.py forms.py models.py' 
            }
            post {
                always {
                    junit 'test-reports/results.xml' 
                }
            }
        } */
        
         
          stage('Deliver') {

            steps {
                sh 'pyinstaller --onefile app.py'
            }
            post {
                success {
                    archiveArtifacts 'dist/app'
                }
            }
        } 


                 stage('nexus') {
            steps {
                echo 'uploading to nexus....'

nexusPublisher nexusInstanceId: '12345', nexusRepositoryId: 'nexus_test', packages: [[$class: 'MavenPackage', mavenAssetList: [[classifier: '', extension: '', filePath: 'build/app/PKG-00.pkg']], mavenCoordinate: [artifactId: '${JOB_NAME}', groupId: 'pythonApp', packaging: 'pkg', version: '1.0.${BUILD_NUMBER}']]]
            }

        } 
    }
}
